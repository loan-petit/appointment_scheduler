# Migration `20200929152106`

This migration has been generated by loan-petit at 9/29/2020, 5:21:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Day" AS ENUM ('SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"username" text   NOT NULL ,
"googleId" text   ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"password" text   ,
"websiteUrl" text   ,
"phone" text   ,
"address" text   ,
"minScheduleNotice" integer   NOT NULL DEFAULT 0,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."OAuthToken" (
"id" SERIAL,
"accessToken" text   NOT NULL ,
"refreshToken" text   ,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AppointmentType" (
"id" SERIAL,
"name" text   NOT NULL ,
"description" text   ,
"duration" integer   NOT NULL ,
"price" Decimal(65,30)   ,
"generateClientSheet" boolean   NOT NULL DEFAULT false,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RecurrentAvailability" (
"id" SERIAL,
"day" "Day"  NOT NULL ,
"startTime" integer   NOT NULL ,
"endTime" integer   NOT NULL ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AvailabilityModifier" (
"id" SERIAL,
"start" timestamp(3)   NOT NULL ,
"end" timestamp(3)   NOT NULL ,
"isExclusive" boolean   NOT NULL ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Customer" (
"id" SERIAL,
"email" text   NOT NULL ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"phone" text   ,
"address" text   ,
"isBlackListed" boolean   NOT NULL DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Appointment" (
"id" SERIAL,
"start" timestamp(3)   NOT NULL ,
"end" timestamp(3)   NOT NULL ,
"googleCalendarEventId" text   ,
"appointmentTypeId" integer   ,
"userId" integer   ,
"customerId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_CustomerToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.googleId_unique" ON "public"."User"("googleId")

CREATE UNIQUE INDEX "OAuthToken_userId_unique" ON "public"."OAuthToken"("userId")

CREATE UNIQUE INDEX "Customer.email_unique" ON "public"."Customer"("email")

CREATE UNIQUE INDEX "_CustomerToUser_AB_unique" ON "public"."_CustomerToUser"("A", "B")

CREATE INDEX "_CustomerToUser_B_index" ON "public"."_CustomerToUser"("B")

ALTER TABLE "public"."OAuthToken" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentType" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RecurrentAvailability" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."AvailabilityModifier" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("appointmentTypeId")REFERENCES "public"."AppointmentType"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_CustomerToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CustomerToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200929152106
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,102 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+  default  = true
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id                      Int                     @default(autoincrement()) @id
+  email                   String                  @unique
+  username                String                  @unique
+  googleId                String?                 @unique
+  firstName               String
+  lastName                String
+  password                String?
+  websiteUrl              String?
+  phone                   String?
+  address                 String?
+  minScheduleNotice       Int                     @default(0)
+  oAuthToken              OAuthToken?
+  recurrentAvailabilities RecurrentAvailability[]
+  availabilityModifiers   AvailabilityModifier[]
+  customers               Customer[]              @relation(references: [id])
+  appointmentTypes        AppointmentType[]
+  appointments            Appointment[]
+}
+
+model OAuthToken {
+  id           Int     @default(autoincrement()) @id
+  accessToken  String
+  refreshToken String?
+  user         User    @relation(fields: [userId], references: [id])
+  userId       Int
+}
+
+model AppointmentType {
+  id                  Int           @default(autoincrement()) @id
+  name                String
+  description         String?
+  duration            Int
+  price               Float?
+  generateClientSheet Boolean       @default(false)
+  user                User?         @relation(fields: [userId], references: [id])
+  userId              Int?
+  appointments        Appointment[]
+}
+
+model RecurrentAvailability {
+  id        Int   @default(autoincrement()) @id
+  day       Day
+  startTime Int
+  endTime   Int
+  user      User? @relation(fields: [userId], references: [id])
+  userId    Int?
+}
+
+model AvailabilityModifier {
+  id          Int      @default(autoincrement()) @id
+  start       DateTime
+  end         DateTime
+  isExclusive Boolean
+  user        User?    @relation(fields: [userId], references: [id])
+  userId      Int?
+}
+
+model Customer {
+  id            Int           @default(autoincrement()) @id
+  email         String        @unique
+  firstName     String
+  lastName      String
+  phone         String?
+  address       String?
+  isBlackListed Boolean       @default(false)
+  users         User[]        @relation(references: [id])
+  appointments  Appointment[]
+}
+
+model Appointment {
+  id                    Int              @default(autoincrement()) @id
+  start                 DateTime
+  end                   DateTime
+  googleCalendarEventId String?
+  appointmentType       AppointmentType? @relation(fields: [appointmentTypeId], references: [id])
+  appointmentTypeId     Int?
+  user                  User?            @relation(fields: [userId], references: [id])
+  userId                Int?
+  customer              Customer?        @relation(fields: [customerId], references: [id])
+  customerId            Int?
+}
+
+enum Day {
+  SUNDAY
+  MONDAY
+  TUESDAY
+  WEDNESDAY
+  THURSDAY
+  FRIDAY
+  SATURDAY
+}
```


