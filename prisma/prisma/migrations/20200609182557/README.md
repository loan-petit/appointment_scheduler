# Migration `20200609182557`

This migration has been generated by loan-petit at 6/9/2020, 6:25:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Customer" (
"address" text   ,"email" text  NOT NULL ,"firstName" text  NOT NULL ,"id" SERIAL,"isBlackListed" boolean  NOT NULL DEFAULT false,"lastName" text  NOT NULL ,"phone" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Appointment" (
"appointmentTypeId" integer   ,"customerId" integer   ,"end" timestamp(3)  NOT NULL ,"googleCalendarEventId" text   ,"id" SERIAL,"start" timestamp(3)  NOT NULL ,"userId" integer   ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "Customer.email" ON "public"."Customer"("email")

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("appointmentTypeId")REFERENCES "public"."AppointmentType"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200608123455..20200609182557
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
   default  = true
 }
 generator client {
@@ -23,8 +23,9 @@
   oAuthToken              OAuthToken?
   appointmentTypes        AppointmentType[]
   recurrentAvailabilities RecurrentAvailability[]
   availabilityModifiers   AvailabilityModifier[]
+  appointments            Appointment[]
 }
 model OAuthToken {
   id           Int     @default(autoincrement()) @id
@@ -34,16 +35,17 @@
   userId       Int
 }
 model AppointmentType {
-  id                  Int     @default(autoincrement()) @id
+  id                  Int           @default(autoincrement()) @id
   name                String
   description         String?
   duration            Int
   price               Float?
-  generateClientSheet Boolean @default(false)
-  user                User?   @relation(fields: [userId], references: [id])
+  generateClientSheet Boolean       @default(false)
+  user                User?         @relation(fields: [userId], references: [id])
   userId              Int?
+  appointments        Appointment[]
 }
 model RecurrentAvailability {
   id        Int   @default(autoincrement()) @id
@@ -62,8 +64,32 @@
   user        User?    @relation(fields: [userId], references: [id])
   userId      Int?
 }
+model Customer {
+  id            Int           @default(autoincrement()) @id
+  email         String        @unique
+  firstName     String
+  lastName      String
+  phone         String?
+  address       String?
+  isBlackListed Boolean       @default(false)
+  appointments  Appointment[]
+}
+
+model Appointment {
+  id                    Int              @default(autoincrement()) @id
+  start                 DateTime
+  end                   DateTime
+  googleCalendarEventId String?
+  appointmentType       AppointmentType? @relation(fields: [appointmentTypeId], references: [id])
+  appointmentTypeId     Int?
+  user                  User?            @relation(fields: [userId], references: [id])
+  userId                Int?
+  customer              Customer?        @relation(fields: [customerId], references: [id])
+  customerId            Int?
+}
+
 enum Day {
   SUNDAY
   MONDAY
   TUESDAY
```


